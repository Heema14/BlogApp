@* @model PostViewModel

@{
    ViewData["Title"] = "Create Post";
}

<style>
    .profile-picture {
        height: 250px;
        width: 250px;
        aspect-ratio: 1 / 1;
        object-fit: cover;
        border-radius: 50%;
        border: 2px solid #0d6efd; /* bootstrap primary color */
        cursor: pointer;
        transition: box-shadow 0.3s ease;
    }

        .profile-picture:hover {
            box-shadow: 0 0 15px #0d6efdaa;
        }
</style> *@

@* <div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold">@ViewData["Title"]</h2>
        <a asp-action="Index" asp-controller="Post" class="btn btn-outline-primary rounded shadow-sm">
            <i class="fas fa-arrow-left me-2"></i> Back to List
        </a>
    </div>

    <form asp-action="Create" method="post" enctype="multipart/form-data" novalidate>

        <div class="mb-4 d-flex flex-column align-items-center justify-content-center">
            <!-- صورة المعاينة التي تعمل كزر لاختيار الملف -->
            <img id="imgPreview" src="~/images/default-image.jpg"
                 alt="Click to upload image"
                 class="img-fluid profile-picture"
                 style="object-fit: cover; cursor: pointer;border-radius:50%;" />

            <!-- حقل الملف مخفي -->
            <input asp-for="FeatureImage" type="file" accept="image/png, image/jpg, image/jpeg" id="imageInput" style="display: none;" />

            <small class="text-muted mt-2">Click the image to upload your profile picture (max 2MB)</small>
            <span asp-validation-for="FeatureImage" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Post.Title" class="form-label"></label>
            <input asp-for="Post.Title" class="form-control form-control" placeholder="Enter post title" />
            <span asp-validation-for="Post.Title" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Post.CategoryId" class="form-label"></label>
            <select asp-for="Post.CategoryId" asp-items="Model.Categories" class="form-select">
                <option value="">Select Category</option>
            </select>
            <span asp-validation-for="Post.CategoryId" class="text-danger"></span>
        </div>
@* 
        <div class="mb-3">
            <label asp-for="Post.Author" class="form-label"></label>
            <input asp-for="Post.Author" class="form-control" placeholder="Author name" />
            <span asp-validation-for="Post.Author" class="text-danger"></span>
        </div> *@

      @*   <div class="mb-4">
            <label asp-for="Post.Content" class="form-label"></label>
            <textarea asp-for="Post.Content" class="form-control" rows="7" placeholder="Write your post content here..."></textarea>
            <span asp-validation-for="Post.Content" class="text-danger"></span>
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100 shadow-sm">Create Post</button>
    </form>
</div>
 
<partial name="_ValidationScriptsPartial" />

@section Scripts {
    <script src="https://cdn.tiny.cloud/1/8v7ap9no879e3vf48t9bipzno7dfbo8dgefvm9kgcttuz3nu/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        tinymce.init({
            selector: 'textarea'
        });

               const imgPreview = document.getElementById('imgPreview');
        const imageInput = document.getElementById('imageInput');

        // عند الضغط على الصورة تفتح نافذة اختيار الملف
        imgPreview.addEventListener('click', () => {
            imageInput.click();
        });

        // عند اختيار ملف، نعرضه كصورة المعاينة
        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    imgPreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

    </script>
}
 *@



 @model Post

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@(Model.Id == 0 ? "Add New Article" : "Edit Article")</title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>@(Model.Id == 0 ? "Add New Article" : "Edit Article")</h2>
        <form method="post" action="@Url.Action("Save")" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="All" class="text-danger"></div>
            <input type="hidden" name="Id" value="@Model.Id" />

            <!-- Select Article Image -->
            <p>Select Article image </p>
            <div class="w-100">
                <div class="text-center mb-4 d-flex justify-content-center">
                    <div class="w-100">
                        <label for="imageInput" class="d-block position-relative" style="cursor:pointer;">
                            <div class="position-relative" style="width: 100%; height: 150px;">
                                <div id="finalImageContainer" class="d-flex justify-content-center align-items-center w-100 h-100" style="background-color:rgba(0,0,0,0.5);">
                                    <svg id="svgIcon" xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 24 24" fill="none">
                                        <circle cx="12" cy="13" r="3" stroke="#1C274C" stroke-width="1.5" />
                                        <path d="M3.0001 12.9999C3.0001 10.191 2.99995 8.78673 3.67407 7.77783C3.96591 7.34107 4.34091 6.96607 4.77767 6.67423C5.78656 6.00011 7.19103 6.00011 9.99995 6.00011H14C16.8089 6.00011 18.2133 6.00011 19.2222 6.67423C19.659 6.96607 20.034 7.34107 20.3258 7.77783C21 8.78673 21.0001 10.191 21.0001 12.9999C21.0001 15.8088 21.0001 17.2133 20.326 18.2222C20.0341 18.6589 19.6591 19.0339 19.2224 19.3258C18.2135 19.9999 16.809 19.9999 14.0001 19.9999H10.0001C7.19117 19.9999 5.78671 19.9999 4.77782 19.3258C4.34106 19.0339 3.96605 18.6589 3.67422 18.2222C3.44239 17.8752 3.29028 17.4815 3.19049 16.9999" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round" />
                                    </svg>
                                    <!-- Show the current image if exists -->
                                    @if (!string.IsNullOrEmpty(Model.FeatureImagePath))
                                    {
                                        <img id="finalImage" src="@Model.FeatureImagePath" class="w-100 h-100 object-fit-cover" style="display:block;">
                                    }
                                    <img id="finalImage" style="display:none;" class="w-100 h-100 object-fit-cover">
                                </div>
                            </div>
                        </label>
                        <!-- Image input -->
                        <input id="imageInput" name="ImageUrl" type="file" accept="image/*" class="d-none" value="@Model.FeatureImagePath" onchange="previewImage(event)">
                    </div>
                </div>
            </div>

            @*            <form asp-action="Create" method="post"> *@
            <div class="form-field">
                <div class="custom-floating-label mb-3">
                    <input class="form-control" name="Title" value="@Model.Title" placeholder="Title" required />
                    <label>Title</label>
                    <span class="text-danger error-message"></span>
                </div>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label for="description">Article Description</label>
                <textarea class="form-control" id="description" name="description" rows="5" placeholder="Enter the article description" required>@Model.Description</textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <!-- Content -->
            <div class="form-group">
                <label for="content">Article Content</label>
                <textarea class="form-control" id="editor" name="content" rows="10" placeholder="Enter the article content" required>
                    @Model.Content
                </textarea>
                <span asp-validation-for="Content" class="text-danger"></span>
            </div>



            <!-- Category Dropdown -->
            <div class="form-group">
                <label for="CategoryId">Category</label>
                <select class="form-control" id="CategoryId" name="CategoryId" required>
                    <option value="">Select a Category</option>
                    @foreach (var category in ViewBag.Categories as List<Category>)
                    {
                        <option value="@category.Id" selected="@((category.Id == Model.CategoryId) ? "selected" : "")">@category.Name</option>
                    }
                </select>
                <span asp-validation-for="CategoryId" class="text-danger"></span>
            </div>



            <button type="submit" class="btn btn-primary">
                @(Model.Id == 0 ? "Save" : "Save Changes")
            </button>

        </form>

        <div>
            <a href="@Url.Action("Index", "Post")">Back to Posts</a>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            ClassicEditor
                .create(document.querySelector('#editor'))
                .then(editor => {
                    editor.model.document.on('change:data', () => {

                        const contentField = document.getElementById('content');
                        if (contentField) {
                            contentField.value = editor.getData();
                        }
                    });
                })
                .catch(error => {
                    console.error("Error initializing CKEditor:", error);
                });
        });
    </script>
    <script>
        function previewImage(event) {
            var reader = new FileReader();
            var file = event.target.files[0];
            reader.onload = function () {
                var finalImage = document.getElementById('finalImage');
                var svgIcon = document.getElementById('svgIcon');

               
                svgIcon.style.display = 'none';
                finalImage.style.display = 'block';
                finalImage.src = reader.result;
            }
            reader.readAsDataURL(file);
        }
    </script>

</body>


